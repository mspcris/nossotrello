<!-- Overlay -->
<div id="modal-overlay" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"
    onclick="closeModal()">
</div>

<!-- Janela -->
<div id="modal" class="hidden fixed inset-0 flex items-center justify-center z-50" aria-modal="true" role="dialog"
    onclick="closeModal()">

    <div id="modal-content" class="bg-white rounded-lg shadow-lg w-full max-w-2xl p-6 transform"
        style="max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">

        <!-- CONTEÚDO QUE O HTMX INJETA -->
        <div id="modal-body" hx-target="this" hx-swap="innerHTML">
        </div>

        <div class="text-right mt-4">
            <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded">
                Fechar
            </button>
        </div>
    </div>
</div>


<script>
    function openModal() {
        const overlay = document.getElementById("modal-overlay");
        const modal = document.getElementById("modal");
        const content = document.getElementById("modal-content");

        overlay.classList.remove("hidden");
        modal.classList.remove("hidden");

        setTimeout(() => {
            content.classList.remove("scale-95", "opacity-0");
            content.classList.add("scale-100", "opacity-100");
        }, 20);
    }

    function closeModal() {
        const overlay = document.getElementById("modal-overlay");
        const modal = document.getElementById("modal");
        const content = document.getElementById("modal-content");

        content.classList.add("scale-95", "opacity-0");
        content.classList.remove("scale-100", "opacity-100");

        setTimeout(() => {
            overlay.classList.add("hidden");
            modal.classList.add("hidden");
        }, 150);
    }

    /* Abre o modal automaticamente quando o HTMX preencher o corpo */
    document.body.addEventListener("htmx:afterSwap", (e) => {
        if (e.detail.target.id === "modal-body") {
            openModal();
            initQuillEditor();  /* Inicializa Quill corretamente */
        }
    });

    /* --- INICIALIZAÇÃO DO QUILL --- */
    function initQuillEditor() {
        const editorDiv = document.getElementById("quill-editor");
        if (!editorDiv) return;  // Não há editor neste modal

        // Evita criar dois editores
        if (window.quillInstance) {
            window.quillInstance = null;
        }

        window.quillInstance = new Quill("#quill-editor", {
            theme: "snow",
            placeholder: "Digite aqui, cole prints ou arraste imagens…"
        });

        // Carregar texto atual (vem do template do card!)
        const descInput = document.getElementById("description-input");
        window.quillInstance.root.innerHTML = descInput.value;

        // Atualizar campo hidden quando digitar
        window.quillInstance.on("text-change", () => {
            descInput.value = window.quillInstance.root.innerHTML;
        });
    }
</script>