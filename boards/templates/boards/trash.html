{# templates/boards/trash.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Lixeira ‚Äî {{ board.name }}{% endblock %}

{% block content %}
<div class="p-4 md:p-6">

  {# HEADER #}
  <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
    <div class="min-w-0">
      <div class="flex items-center gap-2 text-sm text-slate-600">
        <span class="inline-flex items-center justify-center w-6 h-6 rounded-lg bg-slate-100">üóëÔ∏è</span>
        <span class="font-semibold">Lixeira</span>
        <span class="opacity-60">‚Äî</span>
        <span class="truncate">{{ board.name }}</span>
      </div>

      <h1 class="mt-1 text-2xl md:text-3xl font-semibold tracking-tight text-slate-900">
        Restaurar cards exclu√≠dos
      </h1>

      <p class="mt-1 text-sm text-slate-600 max-w-2xl">
        Clique em <strong>Restaurar</strong> para devolver o card ao quadro (na coluna original).
      </p>
    </div>

    <div class="flex items-center gap-2">
      <a href="{% url 'boards:board_detail' board.id %}"
         class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-sm font-semibold text-slate-800">
        ‚Üê Voltar ao quadro
      </a>
    </div>
  </div>

  {# TOOLBAR #}
  <div class="mt-5 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div class="flex items-center gap-2">
      <div class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-50 border border-slate-200 text-sm text-slate-700">
        <span class="opacity-70">Total:</span>
        <strong>{{ cards|length }}</strong>
        <span class="opacity-70">card{{ cards|length|pluralize:"s" }}</span>
      </div>

      <div class="hidden md:flex items-center gap-2 px-3 py-2 rounded-xl bg-amber-50 border border-amber-200 text-sm text-amber-900">
        <span class="opacity-80">Dica:</span>
        <span class="opacity-90">restaurar remove o card da lista na hora.</span>
      </div>
    </div>

    <div class="w-full md:w-[420px]">
      <label for="trash-search" class="sr-only">Buscar na lixeira</label>
      <div class="relative">
        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">üîé</span>
        <input id="trash-search"
               type="text"
               placeholder="Buscar por t√≠tulo, descri√ß√£o ou coluna‚Ä¶"
               class="w-full pl-10 pr-3 py-2 rounded-xl border border-slate-300 bg-white text-sm
                      focus:outline-none focus:ring-2 focus:ring-slate-200">
      </div>
    </div>
  </div>

  {# LISTA #}
  <div id="trash-list" class="mt-5 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
    {% if cards %}
      {% for c in cards %}
        <article class="trash-card group rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden"
                 data-title="{{ c.title|default_if_none:''|lower }}"
                 data-desc="{{ c.description|default_if_none:''|lower }}"
                 data-col="{{ c.column.name|default_if_none:''|lower }}">

          {# TOP STRIP #}
          <div class="px-4 pt-4 pb-3 border-b border-slate-100">
            <div class="flex items-start justify-between gap-3">
              <div class="min-w-0">
                <div class="flex items-center gap-2">
                  <span class="inline-flex items-center justify-center w-7 h-7 rounded-xl bg-slate-100 text-slate-700">
                    üßπ
                  </span>
                  <h2 class="font-semibold text-slate-900 truncate">
                    {{ c.title }}
                  </h2>
                </div>

                <div class="mt-1 text-xs text-slate-600 flex items-center gap-2">
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-slate-50 border border-slate-200">
                    <span class="opacity-70">Coluna:</span>
                    <strong class="font-semibold">{{ c.column.name }}</strong>
                  </span>

                  {% if c.deleted_at %}
                    <span class="text-slate-400">‚Ä¢</span>
                    <span class="opacity-70">Exclu√≠do em</span>
                    <span class="font-semibold text-slate-700">{{ c.deleted_at|date:"d/m/Y H:i" }}</span>
                  {% endif %}
                </div>
              </div>

              <div class="shrink-0">
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold
                             bg-rose-50 text-rose-800 border border-rose-200">
                  na lixeira
                </span>
              </div>
            </div>
          </div>

          {# BODY (descri√ß√£o) #}
          <div class="px-4 py-3">
            {% with d=c.description|default_if_none:'' %}
              {% if d|length %}
                <p class="text-sm text-slate-700 leading-relaxed"
                  style="display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;">
                  {{ d|striptags }}
                </p>
              {% else %}
                <p class="text-sm text-slate-500 italic">Sem descri√ß√£o.</p>
              {% endif %}
            {% endwith %}

          </div>

          {# ACTIONS #}
          <div class="px-4 pb-4 pt-2">
            <div class="flex items-center justify-between gap-2">
              <div class="text-xs text-slate-500">
                Restaurar devolve o card ao quadro.
              </div>

              <div class="flex items-center gap-2">
                <button type="button"
                        class="px-3 py-2 rounded-xl text-sm font-semibold
                               bg-slate-900 text-white hover:bg-slate-800
                               focus:outline-none focus:ring-2 focus:ring-slate-200"
                        hx-post="{% url 'boards:restore_card' c.id %}"
                        hx-headers='{"X-CSRFToken":"{{ csrf_token }}"}'
                        hx-swap="none"
                        hx-confirm="Restaurar este card para o quadro?"
                        hx-on::after-request="
                          if (event.detail && event.detail.successful) {
                            const el = this.closest('.trash-card');
                            if (el) { el.style.opacity='0.35'; el.style.pointerEvents='none'; el.remove(); }
                          }
                        ">
                  ‚Ü© Restaurar
                </button>
              </div>
            </div>
          </div>

        </article>
      {% endfor %}
    {% else %}
      <div class="col-span-full">
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-2xl bg-slate-100 flex items-center justify-center">üóëÔ∏è</div>
            <div>
              <div class="text-lg font-semibold text-slate-900">Lixeira vazia</div>
              <div class="text-sm text-slate-600">Nenhum card exclu√≠do neste quadro.</div>
            </div>
          </div>

          <div class="mt-4">
            <a href="{% url 'boards:board_detail' board.id %}"
               class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-sm font-semibold text-slate-800">
              ‚Üê Voltar ao quadro
            </a>
          </div>
        </div>
      </div>
    {% endif %}
  </div>

</div>

<script>
(function () {
  const input = document.getElementById("trash-search");
  const list = document.getElementById("trash-list");
  if (!input || !list) return;

  function norm(s) { return (s || "").toString().toLowerCase().trim(); }

  function apply() {
    const q = norm(input.value);
    const items = list.querySelectorAll(".trash-card");

    items.forEach((el) => {
      if (!q) { el.style.display = ""; return; }

      const t = norm(el.getAttribute("data-title"));
      const d = norm(el.getAttribute("data-desc"));
      const c = norm(el.getAttribute("data-col"));

      const ok = t.includes(q) || d.includes(q) || c.includes(q);
      el.style.display = ok ? "" : "none";
    });
  }

  input.addEventListener("input", apply);
  document.addEventListener("DOMContentLoaded", apply);
})();
</script>
{% endblock %}
