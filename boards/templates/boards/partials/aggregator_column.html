<div class="column-item aggregator-column">
<div
  class="column-item aggregator-column w-64 shrink-0"
  data-aggregator="1"
  aria-disabled="true"
>

  <!-- HEADER -->
  <div class="column-header px-3 py-2">
    <h3 class="font-semibold text-sm">
      Coluna Agrupadora
    </h3>
  </div>

  <!-- BODY -->
  <ul class="px-3 pb-3 space-y-2">
    {% for col in columns %}
      <li
        class="aggregator-card select-none"
        data-column-id="{{ col.id }}"
      >
        <span class="aggregator-count">
          {{ col.cards.count|stringformat:"02d" }}
        </span>
        <span class="aggregator-name">
          {{ col.name }}
        </span>
      </li>
    {% endfor %}
  </ul>
</div>
</div>

<script>
  // ============================================================
  // Aggregator Column — runtime update
  // ============================================================
  window.updateAggregatorCounts = function () {
    const agg = document.querySelector(".aggregator-column");
    if (!agg) return;

    agg.querySelectorAll(".aggregator-card").forEach(card => {
      const colId = card.dataset.columnId;
      const list = document.getElementById("cards-col-" + colId);
      if (!list) return;

      const count = list.querySelectorAll("li[data-card-id]").length;
      const label = String(count).padStart(2, "0");

      const countEl = card.querySelector(".aggregator-count");
      if (countEl) countEl.textContent = label;
    });
  };

  document.addEventListener("DOMContentLoaded", updateAggregatorCounts);
  document.body.addEventListener("htmx:afterSwap", updateAggregatorCounts);
</script>


<script>
  // ============================================================
  // Aggregator Column — runtime update (espelha o header da coluna)
  // ============================================================
  window.updateAggregatorCounts = function () {
    const agg = document.querySelector(".aggregator-column");
    if (!agg) return;

    agg.querySelectorAll(".aggregator-card").forEach(card => {
      const colId = card.dataset.columnId;
      if (!colId) return;

      // acha a coluna real
      const colEl = document.querySelector(`.column-item[data-column-id="${colId}"]`);
      if (!colEl) return;

      // pega o texto que já está correto no header (ex: "4 cards")
      const counterEl = colEl.querySelector("[data-column-counter]");
      if (!counterEl) return;

      const txt = (counterEl.textContent || "").trim(); // "4 cards"
      const n = parseInt(txt, 10);
      const label = String(Number.isFinite(n) ? n : 0).padStart(2, "0");

      const countEl = card.querySelector(".aggregator-count");
      if (countEl) countEl.textContent = label;
    });
  };

  document.addEventListener("DOMContentLoaded", window.updateAggregatorCounts);
  document.body.addEventListener("htmx:afterSwap", window.updateAggregatorCounts);
  document.body.addEventListener("htmx:afterSettle", window.updateAggregatorCounts);
</script>
